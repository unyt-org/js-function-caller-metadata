var __awaiter=this&&this.__awaiter||function(t,e,a,l){return new(a||(a=Promise))(function(n,r){function i(t){try{c(l.next(t))}catch(e){r(e)}}function o(t){try{c(l.throw(t))}catch(e){r(e)}}function c(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(i,o)}c((l=l.apply(t,e||[])).next())})};let caller_file=/((?:https?|file)\:\/\/.*?)(?::\d+)*(?:$|\nevaluate@|\)$)/,caller_row_col=/(\d+)\:(\d+)(\))?$/,caller_name=/([^ ]*)(?:@| \()(?:https?|file)\:\/\//,extract_meta=/__meta__([^_]+)__/,is_safari=!globalThis.Deno&&"function"==typeof globalThis.webkitConvertPointFromNodeToPage,meta=new Map,min_key=0;function createMetaMapping(t){for(;meta.has(min_key);)min_key++;return meta.set(min_key,t),min_key}function removeMeta(t){meta.delete(t),t<min_key&&(min_key=t)}function _callWithMetaData(t,e,a,l){var n;let r="__meta__"+t+"__",i=null!==(n=a)&&void 0!==n?n:[];return is_safari?new globalThis.Function("f","c","a","return (function "+r+"(){return c ? f.apply(c, a) : f(a)})()")(e,l,a):({[r]:()=>l?e.apply(l,i):e(...i)})[r]()}function getPartsFromStack(t){return t?t.trim().replace(/^Error\n/,"").replace(/(\n.*@\[native code\])+$/,"").replace(/\n *at ModuleJob\.run \(node\:internal\/(.|\n)*$/,"").split("\n"):null}export function getCallerFile(){var t,e;let a=getPartsFromStack(Error().stack);return null===(e=null===(t=null==a?void 0:a[Math.min(a.length-1,2)])||void 0===t?void 0:t.match(caller_file))||void 0===e?void 0:e[1]}export function getCallerDir(){var t,e,a;let l=getPartsFromStack(Error().stack);return null===(a=null===(e=null===(t=null==l?void 0:l[Math.min(l.length-1,2)])||void 0===t?void 0:t.match(caller_file))||void 0===e?void 0:e[1])||void 0===a?void 0:a.replace(/[^\/\\]*$/,"")}export function getCallerInfo(){var t,e;let a=getPartsFromStack(Error().stack);if(!a)return null;a=a.slice(Math.min(a.length-1,2));let l=[];for(let n of a){let r=n.match(caller_row_col),i=n.trim().startsWith("module code")?null:null===(t=n.match(caller_name))||void 0===t?void 0:t[1];"at"==i&&n.trim().startsWith("at ")&&(i=null),l.push({file:(null===(e=n.match(caller_file))||void 0===e?void 0:e[1])||null,name:i||null,row:(null==r?void 0:r[1])?Number(null==r?void 0:r[1]):null,col:(null==r?void 0:r[2])?Number(null==r?void 0:r[2]):null})}return l}export function callWithMetadata(t,e,a,l){let n=createMetaMapping(t);try{let r=_callWithMetaData(n,e,a,l);return removeMeta(n),r}catch(i){throw removeMeta(n),i}}export function callWithMetadataAsync(t,e,a,l){return __awaiter(this,void 0,void 0,function*(){let n=createMetaMapping(t);try{let r=yield _callWithMetaData(n,e,a,l);return removeMeta(n),r}catch(i){throw removeMeta(n),i}})}export function getMeta(){var t,e;let a=null===(e=null===(t=Error().stack)||void 0===t?void 0:t.match(extract_meta))||void 0===e?void 0:e[1];return meta.get(Number(a))}export function clearMeta(){var t,e;let a=Number(null===(e=null===(t=Error().stack)||void 0===t?void 0:t.match(extract_meta))||void 0===e?void 0:e[1]);isNaN(a)||removeMeta(a)}