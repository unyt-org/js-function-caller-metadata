var __awaiter=this&&this.__awaiter||function(t,e,l,a){return new(l||(l=Promise))(function(n,i){function r(t){try{c(a.next(t))}catch(e){i(e)}}function o(t){try{c(a.throw(t))}catch(e){i(e)}}function c(t){var e;t.done?n(t.value):((e=t.value)instanceof l?e:new l(function(t){t(e)})).then(r,o)}c((a=a.apply(t,e||[])).next())})};let caller_file=/((?:https?|file)\:\/\/.*?)(?::\d+)*(?:$|\nevaluate@|\)$)/,caller_row_col=/(\d+)\:(\d+)(\))?$/,caller_name=/([^ ]*)(?:@| \()(?:https?|file)\:\/\//,extract_meta=/__meta__([^_]+)__/,is_safari=!globalThis.Deno&&"function"==typeof globalThis.webkitConvertPointFromNodeToPage,meta=new Map,min_key=0;function createMetaMapping(t){for(;meta.has(min_key);)min_key++;return meta.set(min_key,t),min_key}function removeMeta(t){meta.delete(t),t<min_key&&(min_key=t)}function _callWithMetaData(t,e,l,a){var n;let i="__meta__"+t+"__",r=null!==(n=l)&&void 0!==n?n:[];return is_safari?new globalThis.Function("f","c","a","return (function "+i+"(){return c ? f.apply(c, a) : f(a)})()")(e,a,l):({[i]:()=>a?e.apply(a,r):e(...r)})[i]()}function getPartsFromStack(t){return t?t.trim().replace(/^Error\n/,"").replace(/(\n.*@\[native code\])+$/,"").replace(/\n *at ModuleJob\.run \(node\:internal\/(.|\n)*$/,"").split("\n"):null}export function getCallerFile(){var t,e,l,a;let n=getPartsFromStack(Error().stack);return null!==(l=null===(e=null===(t=null==n?void 0:n[Math.min(n.length-1,2)])||void 0===t?void 0:t.match(caller_file))||void 0===e?void 0:e[1])&&void 0!==l?l:null===(a=window.location)||void 0===a?void 0:a.href}export function getCallerDir(){var t,e,l,a,n;let i=getPartsFromStack(Error().stack);return null!==(a=null===(l=null===(e=null===(t=null==i?void 0:i[Math.min(i.length-1,2)])||void 0===t?void 0:t.match(caller_file))||void 0===e?void 0:e[1])||void 0===l?void 0:l.replace(/[^\/\\]*$/,""))&&void 0!==a?a:null===(n=window.location)||void 0===n?void 0:n.href}export function getCallerInfo(){var t,e;let l=getPartsFromStack(Error().stack);if(!l)return null;is_safari&&l[1].startsWith("@")&&l.splice(1,1),l=l.slice(Math.min(l.length-1,2));let a=[];for(let n of l){let i=n.match(caller_row_col),r=n.trim().startsWith("module code")?null:null===(t=n.match(caller_name))||void 0===t?void 0:t[1];"at"==r&&n.trim().startsWith("at ")&&(r=null),a.push({file:(null===(e=n.match(caller_file))||void 0===e?void 0:e[1])||null,name:r||null,row:(null==i?void 0:i[1])?Number(null==i?void 0:i[1]):null,col:(null==i?void 0:i[2])?Number(null==i?void 0:i[2]):null})}return a}export function callWithMetadata(t,e,l,a){let n=createMetaMapping(t);try{let i=_callWithMetaData(n,e,l,a);return removeMeta(n),i}catch(r){throw removeMeta(n),r}}export function callWithMetadataAsync(t,e,l,a){return __awaiter(this,void 0,void 0,function*(){let n=createMetaMapping(t);try{let i=yield _callWithMetaData(n,e,l,a);return removeMeta(n),i}catch(r){throw removeMeta(n),r}})}export function getMeta(){var t,e;let l=null===(e=null===(t=Error().stack)||void 0===t?void 0:t.match(extract_meta))||void 0===e?void 0:e[1];return meta.get(Number(l))}export function clearMeta(){var t,e;let l=Number(null===(e=null===(t=Error().stack)||void 0===t?void 0:t.match(extract_meta))||void 0===e?void 0:e[1]);isNaN(l)||removeMeta(l)}